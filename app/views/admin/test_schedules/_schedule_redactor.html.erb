<%= turbo_frame_tag "schedule_editor" do %>
  <% if schedule.id.present? %>
    <% url = admin_test_schedule_path(schedule.id) %>
    <% method = :patch  %>
  <% else %>
    <% url = admin_test_schedules_path %>
    <% method = :post %>
  <% end %>

  <%= render 'errors', schedule: schedule %>

  <%= form_with model: schedule, url: url, method: method, data: { controller: "schedule-form teacher-selection classroom-selection", action: "turbo:submit-end->schedule-form#handleResponse", turbo: false  } do |f| %>
    <%= f.hidden_field :teacher_id, value: schedule.teacher_id || 0, data: { teacher_selection_target: "hiddenField" } %>
    <%= f.hidden_field :special_period_id, value: schedule.special_period_id %>
    <%= f.hidden_field :student_group_id, value: group_id %>
    <%= f.hidden_field :start_time, value: time %>
    <%= f.hidden_field :classroom_id, value: schedule.classroom_id || nil , data: { classroom_selection_target: "hiddenField" } %>
    <%= f.hidden_field :lesson_id, value: lesson_id %>
    <%= f.hidden_field :course, value: course %>

    <% if schedule.id.present? %>
      <h4>Редактирование расписания</h4>
    <% else %>
      <h4>Новое расписание</h4>
    <% end %>
      
    <p>Время: <%= time %></p>

    <%= render partial: "teachers", locals: { teachers: @teachers, selected_teacher: schedule.teacher } %>

    <%= render partial: "classrooms", locals: { classrooms: @classrooms, schedule: schedule } %>

    <%= f.label :subject_id, "Предмет", class: "form-label" %>
    <%= f.text_field :subject_id, class: "form-control", value: schedule&.subject&.name || nil %>


    <div class="mt-3">
      <%= f.submit "Сохранить", class: "btn btn-primary" %>
      <% if schedule.id.present? %>
        <%= button_to "Удалить", admin_test_schedule_path(schedule.id), method: :delete, data: { turbo_method: :delete, turbo_confirm: "Вы уверены?" }, class: "btn btn-danger" %>
      <% end %>
    </div>
  <% end %>
<% end %>